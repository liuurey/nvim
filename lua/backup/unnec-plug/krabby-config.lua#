-- Krabby é…ç½®é€‰é¡¹
-- å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›å˜é‡æ¥è‡ªå®šä¹‰ Krabby çš„è¡Œä¸º

-- è®¾ç½®æ˜¯å¦åœ¨å¯åŠ¨æ—¶æ˜¾ç¤º Krabbyï¼ˆé»˜è®¤å…³é—­ï¼‰
vim.g.krabby_on_startup = false

-- Krabby é«˜çº§é…ç½®ç¤ºä¾‹
-- åˆ›å»ºé…ç½®è®¾ç½®å‡½æ•°
local function setup_krabby_config()
  -- æ£€æŸ¥æ˜¯å¦å®‰è£…äº† Krabby
  if vim.fn.executable('krabby') == 0 then
    return false
  end
  
  -- å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šé…ç½®é€‰é¡¹
  vim.g.krabby_installed = true
  
  return true
end

-- åˆå§‹åŒ–é…ç½®
setup_krabby_config()

-- æä¾›ä¾¿æ·çš„é…ç½®åˆ‡æ¢å‡½æ•°
function KrabbyQuickSetup()
  print("ğŸ¦€ Krabby å¿«é€Ÿè®¾ç½®:")
  print("1. å®‰è£… Krabby: cargo install krabby")
  print("2. å¯ç”¨å¯åŠ¨ç”»é¢: vim.g.krabby_on_startup = true")
  print("3. ä½¿ç”¨å‘½ä»¤:")
  print("   â€¢ :Krabby - æ˜¾ç¤ºç”»é¢")
  print("   â€¢ :KrabbyToggle - åˆ‡æ¢å¯åŠ¨æ˜¾ç¤º")
  print("   â€¢ <leader>Dk - å¿«æ·æ˜¾ç¤º")
  print("   â€¢ <leader>Dt - å¿«æ·åˆ‡æ¢")
  
  local choice = vim.fn.confirm(
    "æ˜¯å¦ç°åœ¨å¯ç”¨ Krabby å¯åŠ¨ç”»é¢ï¼Ÿ",
    "&æ˜¯\n&å¦",
    2
  )
  
  if choice == 1 then
    vim.g.krabby_on_startup = true
    vim.notify("ğŸ¦€ Krabby å¯åŠ¨ç”»é¢å·²å¯ç”¨ï¼é‡å¯ Neovim ç”Ÿæ•ˆ", vim.log.levels.INFO)
  end
end

-- æ³¨å†Œå¿«é€Ÿè®¾ç½®å‘½ä»¤
vim.api.nvim_create_user_command('KrabbyQuickSetup', KrabbyQuickSetup, {
  desc = 'ğŸ¦€ Krabby å¿«é€Ÿè®¾ç½®å‘å¯¼'
})

return {
  -- è¿”å›é…ç½®çŠ¶æ€
  enabled = vim.g.krabby_installed or false,
  startup = vim.g.krabby_on_startup or false,
}